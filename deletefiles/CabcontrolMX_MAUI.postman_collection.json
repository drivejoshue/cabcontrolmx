{
  "info": {
    "name": "CabcontrolMX · MAUI (Driver & Passenger)",
    "_postman_id": "cabcontrolmx-maui-collection",
    "description": "Colección Postman para probar endpoints backend que invocan SPs. Usa variables de entorno: base_url, api_key, tenant_id, driver_id.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Driver",
      "item": [
        {
          "name": "Offers · Accept (sp_accept_offer_v3)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_accept_offer_v3",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_accept_offer_v3"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"offer_id\": 123\n}"
            }
          }
        },
        {
          "name": "Offers · Reject (sp_reject_offer_v2)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_reject_offer_v2",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_reject_offer_v2"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"offer_id\": 123\n}"
            }
          }
        },
        {
          "name": "Rides · Complete (sp_complete_ride_v1)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_complete_ride_v1",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_complete_ride_v1"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"ride_id\": 1001,\n  \"distance_m\": 5050,\n  \"duration_s\": 880\n}"
            }
          }
        },
        {
          "name": "Rides · Release (sp_release_ride_v1)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_release_ride_v1",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_release_ride_v1"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"ride_id\": 1001\n}"
            }
          }
        }
      ]
    },
    {
      "name": "Passenger",
      "item": [
        {
          "name": "Rides · Create (example)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rides",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rides"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"passenger_id\": 2,\n  \"payment_method\": \"cash\",\n  \"origin_lat\": 19.173773,\n  \"origin_lng\": -96.134224,\n  \"dest_lat\": 19.1805,\n  \"dest_lng\": -96.1429,\n  \"requested_channel\": \"passenger_app\"\n}"
            }
          },
          "description": "Endpoint ejemplar; tu backend debería crear el ride y calcular tarifa usando Services."
        },
        {
          "name": "Rides · Cancel (sp_cancel_ride_v2)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_cancel_ride_v2",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_cancel_ride_v2"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"ride_id\": 1001,\n  \"canceled_by\": \"passenger\",\n  \"reason\": \"Cambio de plan\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "Dispatch (Opcional)",
      "item": [
        {
          "name": "Offers · Wave v1 (radio)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_offer_wave_v1",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_offer_wave_v1"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"ride_id\": 1001,\n  \"radius_km\": 5.0,\n  \"limit_n\": 3,\n  \"expires_sec\": 30\n}"
            }
          }
        },
        {
          "name": "Offers · Wave v2 (list CSV)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_offer_wave_v2",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_offer_wave_v2"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"ride_id\": 1001,\n  \"driver_ids_csv\": \"1,2,3\",\n  \"expires_sec\": 30\n}"
            }
          }
        },
        {
          "name": "Offers · Expire (sp_expire_offers_v2)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/rpc/sp_expire_offers_v2",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "rpc",
                "sp_expire_offers_v2"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"{{tenant_id}}\",\n  \"ride_id\": 1001\n}"
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000/api"
    },
    {
      "key": "api_key",
      "value": "REPLACE_ME"
    },
    {
      "key": "tenant_id",
      "value": "1"
    },
    {
      "key": "driver_id",
      "value": "1"
    }
  ]
}